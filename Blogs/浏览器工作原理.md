#  浏览器工作原理

## 一、浏览器发展

​		浏览器初步从效率低的单进程单线程发展到单进程多线程，实现了多任务同时进行，但是一个卡顿可能导致整个进程的崩溃。所以发展到了现在的多进程，将多个任务进程进行隔离后，避免因为一个任务进程导致的整个页面的崩溃，分为了渲染进程，插件进程，网络进程，GPU进程，浏览器主进程。

## 二、传输数据

​		服务器发送数据包的过程中，首先利用稳定的TCP连接（也就是三次握手）绑定数据包的端口号，然后将IP（也就是计算机的IP地址）头绑定到数据包，在网络底层根据IP找到计算机地址，根据端口号找到对应的应用程序或这网页，最后断开TCP连接（四次挥手）。也就完成了数据包的传输进程。

## 三、从用户到浏览器页面渲染过程

  + 用户输入搜索内容，浏览器判断是否是URL或者搜索内容，如果是URL就补全进行搜索
  + 浏览器根据URL首先查看缓存，如果有本地缓存则直接根据缓存进行加载，没有就进行下一步
  + 浏览器根据状态码判断是否需要重定向，如果是301则进行重定向，200则不需要
  + 浏览器根据响应数据content-type判断网页是下载数据还是一般网页
  + 浏览器准备渲染进程并提交文档
  + 浏览器执行渲染进程
      + 根据文档生成dom树
      + 在使用css进行样式计算，也就是转换为浏览器可识别的stylesheets结构，期间有样式重叠和继承等css基本规则
      + 进入布局阶段，浏览器根据框架结构生成布局树，进行布局计算
      + 浏览器根据3d效果进行类似于ps中的图层渲染的操作，将布局分为一个个图层生成图层树，进行覆盖使用。
      + 浏览器为了用户的体验，最后还会将页面视口化，将页面分为一个个图块以便滑动，
      + 最后浏览将这所有的进行合成并交给绘制程序进行绘制页面。
      + 如果期间结构改变，将进行重排，重绘和合成。如果只是样式改变将只是进行重绘和合成阶段，开销更小一点。